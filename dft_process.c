//
// Created by 72989 on 2018/8/18.
//

#include "dft_process.h"
#include <math.h>

#define PI      3.1415926f

float  const sin_table[400] = {  0,0.015746681,0.031489456,0.047224423,0.06294768,0.078655328,0.094343471,0.110008219,0.125645688,0.141252001,0.156823287,0.172355684,0.187845343,0.20328842,0.218681088,0.234019528,0.249299938,0.264518528,0.279671524,0.29475517,0.309765724,0.324699464,0.339552687,0.354321711,0.369002872,0.383592531,0.398087068,0.412482891,0.426776429,0.440964137,0.455042499,0.469008022,0.482857243,0.496586729,0.510193075,0.523672906,0.53702288,0.550239687,0.56332005,0.576260724,0.5890585,0.601710206,0.614212704,0.626562893,0.638757712,0.650794135,0.662669179,0.674379899,0.685923391,0.697296792,0.708497282,0.719522083,0.730368462,0.741033729,0.75151524,0.761810395,0.771916641,0.781831473,0.791552431,0.801077105,0.810403134,0.819528204,0.828450053,0.837166469,0.84567529,0.853974405,0.862061758,0.869935343,0.877593207,0.885033451,0.89225423,0.899253754,0.906030288,0.912582149,0.918907715,0.925005417,0.930873741,0.936511234,0.941916497,0.94708819,0.95202503,0.956725793,0.961189314,0.965414486,0.96940026,0.97314565,0.976649725,0.979911617,0.982930517,0.985705676,0.988236407,0.990522081,0.992562133,0.994356055,0.995903404,0.997203795,0.998256907,0.999062477,0.999620306,0.999930257,0.999992251,0.999806274,0.999372371,0.998690651,0.997761282,0.996584495,0.995160582,0.993489895,0.99157285,0.989409921,0.987001644,0.984348618,0.981451499,0.978311007,0.974927919,0.971303075,0.967437374,0.963331775,0.958987295,0.954405011,0.949586061,0.944531639,0.939242998,0.933721449,0.927968363,0.921985166,0.91577334,0.909334428,0.902670024,0.895781783,0.888671411,0.881340673,0.873791386,0.866025422,0.858044706,0.849851219,0.841446991,0.832834106,0.824014701,0.814990963,0.805765128,0.796339485,0.786716371,0.776898173,0.766887324,0.756686308,0.746297654,0.735723937,0.724967781,0.714031853,0.702918863,0.691631569,0.680172768,0.668545302,0.656752055,0.644795951,0.632679955,0.620407071,0.607980343,0.595402852,0.582677717,0.569808093,0.556797172,0.54364818,0.530364378,0.51694906,0.503405552,0.489737213,0.475947433,0.46203963,0.448017253,0.433883781,0.419642716,0.405297592,0.390851964,0.376309416,0.361673552,0.346948004,0.332136421,0.317242478,0.302269867,0.287222301,0.272103512,0.256917248,0.241667276,0.226357376,0.210991346,0.195572996,0.180106149,0.16459464,0.149042317,0.133453034,0.117830659,0.102179066,0.086502134,0.070803752,0.055087813,0.039358213,0.023618854,0.007873638,-0.007873531,-0.023618747,-0.039358106,-0.055087706,-0.070803645,-0.086502027,-0.102178959,-0.117830553,-0.133452928,-0.149042211,-0.164594535,-0.180106044,-0.195572891,-0.210991242,-0.226357272,-0.241667172,-0.256917145,-0.272103409,-0.287222199,-0.302269765,-0.317242376,-0.33213632,-0.346947903,-0.361673452,-0.376309316,-0.390851865,-0.405297494,-0.419642619,-0.433883684,-0.448017157,-0.462039535,-0.475947338,-0.48973712,-0.50340546,-0.516948968,-0.530364288,-0.54364809,-0.556797083,-0.569808005,-0.58267763,-0.595402766,-0.607980258,-0.620406987,-0.632679872,-0.644795869,-0.656751974,-0.668545222,-0.680172689,-0.691631491,-0.702918787,-0.714031778,-0.724967708,-0.735723865,-0.746297582,-0.756686238,-0.766887255,-0.776898105,-0.786716305,-0.79633942,-0.805765064,-0.814990901,-0.824014641,-0.832834047,-0.841446933,-0.849851162,-0.858044651,-0.866025368,-0.873791334,-0.881340622,-0.888671362,-0.895781735,-0.902669978,-0.909334383,-0.915773297,-0.921985124,-0.927968323,-0.933721411,-0.939242961,-0.944531603,-0.949586027,-0.954404979,-0.958987264,-0.963331746,-0.967437347,-0.97130305,-0.974927895,-0.978310984,-0.981451478,-0.984348599,-0.987001627,-0.989409905,-0.991572836,-0.993489883,-0.995160571,-0.996584486,-0.997761275,-0.998690646,-0.999372367,-0.999806272,-0.99999225,-0.999930258,-0.999620309,-0.999062482,-0.998256913,-0.997203803,-0.995903414,-0.994356067,-0.992562146,-0.990522096,-0.988236423,-0.985705694,-0.982930536,-0.979911638,-0.976649748,-0.973145674,-0.969400287,-0.965414514,-0.961189344,-0.956725824,-0.952025063,-0.947088224,-0.941916533,-0.936511272,-0.93087378,-0.925005457,-0.918907758,-0.912582193,-0.906030333,-0.899253801,-0.892254279,-0.885033501,-0.877593258,-0.869935396,-0.862061813,-0.853974461,-0.845675347,-0.837166528,-0.828450113,-0.819528266,-0.810403197,-0.80107717,-0.791552497,-0.78183154,-0.771916709,-0.761810464,-0.751515311,-0.741033801,-0.730368535,-0.719522157,-0.708497357,-0.697296868,-0.685923469,-0.674379978,-0.66266926,-0.650794217,-0.638757794,-0.626562977,-0.614212788,-0.601710292,-0.589058587,-0.576260811,-0.563320138,-0.550239777,-0.537022971,-0.523672997,-0.510193167,-0.496586822,-0.482857337,-0.469008116,-0.455042594,-0.440964234,-0.426776526,-0.412482988,-0.398087166,-0.383592629,-0.369002972,-0.354321811,-0.339552788,-0.324699565,-0.309765825,-0.294755272,-0.279671627,-0.264518631,-0.249300041,-0.234019632,-0.218681192,-0.203288525,-0.187845448,-0.17235579,-0.156823393,-0.141252107,-0.125645795,-0.110008326,-0.094343577,-0.078655435,-0.062947787,-0.047224531,-0.031489563,-0.015746788,-1.07E-07 };
                                    
float const cos_table[400] = { 1,0.999876013,0.999504084,0.998884305,0.998016828,0.996901871,0.995539708,0.993930678,0.992075179,0.989973673,0.987626679,0.98503478,0.982198619,0.979118899,0.975796383,0.972231896,0.968426322,0.964380604,0.960095744,0.955572807,0.950812914,0.945817244,0.940587036,0.935123588,0.929428255,0.923502448,0.917347636,0.910965348,0.904357164,0.897524724,0.890469721,0.883193906,0.875699082,0.867987108,0.860059897,0.851919414,0.843567677,0.835006758,0.82623878,0.817265917,0.808090393,0.798714485,0.789140516,0.779370862,0.769407945,0.759254235,0.74891225,0.738384555,0.727673761,0.716782522,0.705713541,0.694469562,0.683053372,0.671467804,0.65971573,0.647800063,0.63572376,0.623489814,0.611101259,0.598561167,0.585872649,0.573038849,0.560062951,0.546948172,0.533697765,0.520315015,0.506803241,0.493165793,0.479406053,0.465527433,0.451533375,0.437427349,0.423212852,0.40889341,0.394472573,0.379953917,0.365341043,0.350637575,0.335847157,0.320973458,0.306020167,0.29099099,0.275889656,0.260719908,0.245485509,0.230190236,0.214837882,0.199432254,0.183977171,0.168476468,0.152933987,0.137353582,0.121739117,0.106094464,0.090423503,0.074730119,0.059018204,0.043291654,0.027554369,0.011810251,-0.003936796,-0.019682866,-0.035424056,-0.051156461,-0.066876181,-0.082579317,-0.098261976,-0.113920269,-0.129550312,-0.145148231,-0.160710156,-0.17623223,-0.191710602,-0.207141436,-0.222520904,-0.237845193,-0.253110503,-0.268313047,-0.283449058,-0.29851478,-0.313506479,-0.328420437,-0.343252955,-0.358000356,-0.372658982,-0.387225199,-0.401695394,-0.416065979,-0.430333391,-0.444494092,-0.45854457,-0.472481342,-0.48630095,-0.499999969,-0.513575001,-0.527022681,-0.540339673,-0.553522675,-0.566568418,-0.579473667,-0.592235222,-0.604849919,-0.617314629,-0.629626262,-0.641781764,-0.653778121,-0.665612359,-0.677281543,-0.688782778,-0.700113215,-0.711270041,-0.722250492,-0.733051844,-0.743671419,-0.754106583,-0.764354748,-0.774413374,-0.784279966,-0.793952078,-0.803427311,-0.812703315,-0.821777791,-0.830648487,-0.839313205,-0.847769795,-0.856016162,-0.864050259,-0.871870095,-0.87947373,-0.886859279,-0.894024911,-0.900968848,-0.907689369,-0.914184808,-0.920453552,-0.92649405,-0.932304801,-0.937884365,-0.943231359,-0.948344458,-0.953222391,-0.957863952,-0.962267987,-0.966433406,-0.970359175,-0.97404432,-0.977487929,-0.980689147,-0.98364718,-0.986361295,-0.988830819,-0.991055139,-0.993033703,-0.994766022,-0.996251665,-0.997490265,-0.998481514,-0.999225165,-0.999721036,-0.999969002,-0.999969003,-0.999721038,-0.99922517,-0.998481519,-0.997490273,-0.996251675,-0.994766033,-0.993033716,-0.991055153,-0.988830835,-0.986361313,-0.983647199,-0.980689168,-0.977487952,-0.974044345,-0.970359201,-0.966433433,-0.962268016,-0.957863982,-0.953222424,-0.948344492,-0.943231395,-0.937884402,-0.93230484,-0.92649409,-0.920453594,-0.914184851,-0.907689414,-0.900968894,-0.894024959,-0.886859328,-0.879473781,-0.871870147,-0.864050313,-0.856016217,-0.847769852,-0.839313263,-0.830648547,-0.821777852,-0.812703378,-0.803427375,-0.793952143,-0.784280033,-0.774413442,-0.764354817,-0.754106653,-0.74367149,-0.733051917,-0.722250566,-0.711270117,-0.700113291,-0.688782856,-0.677281621,-0.665612439,-0.653778202,-0.641781846,-0.629626345,-0.617314714,-0.604850004,-0.592235309,-0.579473754,-0.566568506,-0.553522764,-0.540339763,-0.527022772,-0.513575093,-0.500000062,-0.486301044,-0.472481436,-0.458544665,-0.444494188,-0.430333488,-0.416066076,-0.401695492,-0.387225297,-0.372659081,-0.358000456,-0.343253056,-0.328420538,-0.313506581,-0.298514883,-0.283449161,-0.268313151,-0.253110606,-0.237845297,-0.222521009,-0.207141541,-0.191710708,-0.176232335,-0.160710262,-0.145148337,-0.129550418,-0.113920375,-0.098262083,-0.082579424,-0.066876288,-0.051156568,-0.035424163,-0.019682973,-0.003936903,0.011810144,0.027554262,0.043291547,0.059018097,0.074730012,0.090423396,0.106094358,0.121739011,0.137353476,0.152933881,0.168476362,0.183977066,0.199432149,0.214837777,0.230190132,0.245485405,0.260719805,0.275889553,0.290990888,0.306020065,0.320973357,0.335847056,0.350637474,0.365340944,0.379953818,0.394472474,0.408893312,0.423212755,0.437427252,0.451533279,0.465527338,0.479405959,0.4931657,0.506803148,0.520314924,0.533697674,0.546948083,0.560062862,0.573038761,0.585872562,0.598561082,0.611101174,0.62348973,0.635723677,0.647799982,0.659715649,0.671467725,0.683053294,0.694469485,0.705713465,0.716782448,0.727673687,0.738384483,0.748912179,0.759254165,0.769407876,0.779370795,0.78914045,0.79871442,0.80809033,0.817265855,0.82623872,0.835006699,0.84356762,0.851919358,0.860059842,0.867987055,0.87569903,0.883193856,0.890469672,0.897524676,0.904357118,0.910965304,0.917347594,0.923502406,0.929428215,0.93512355,0.940587,0.945817209,0.95081288,0.955572776,0.960095715,0.964380575,0.968426295,0.972231871,0.97579636,0.979118877,0.982198599,0.985034762,0.987626662,0.989973657,0.992075166,0.993930666,0.995539698,0.996901862,0.998016822,0.998884299,0.999504081,0.999876012,1 };

bool dft_process(int32_t *data,uint32_t time_len,int32_t *real,int32_t *img)
{
    uint16_t i,j;
    float w = 0.0f;
    uint8_t delta = 0;
    int32_t temp_real,temp_img;

    /*
     *  sample rate: 4HZ                2*PI                400
     *  resolution : 0.01HZ             0.01*PI/2           1
     *
     * */    
    //w = 0.01*PI/2;
    delta = 1;
    
    for(i = 0;i < 37;i++)
    {
        temp_real   = 0;
        temp_img    = 0;
        for(j = 0;j < time_len;j++)
        {
            temp_real   = temp_real + data[j]*(int32_t)(255*cos_table[delta*i*j%400]);
            temp_img    = temp_img  + data[j]*(int32_t)(255*sin_table[delta*i*j%400]);
        }
        //DEBUG_PRINT("%d\t%d\r\n",temp_real_1,temp_img_1);
        DEBUG_PRINT("%d\t%d\r\n",temp_real,temp_img);
    }
    
 

}
